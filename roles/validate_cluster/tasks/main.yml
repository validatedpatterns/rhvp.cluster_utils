---
- name: Verify cluster connectivity and authentication
  kubernetes.core.k8s_cluster_info:
  register: cluster_info
  failed_when: false

- name: Assert cluster is reachable
  ansible.builtin.assert:
    that: cluster_info.version is defined
    fail_msg: |
      Could not connect to the cluster.
      Ensure your KUBECONFIG is set or you are logged in (e.g., 'oc login').
    quiet: true

- name: Fetch StorageClasses
  kubernetes.core.k8s_info:
    kind: StorageClass
  register: sc_list

- name: StorageClass Status
  ansible.builtin.debug:
    msg: >-
      {{ 'OK: StorageClass found.' if (sc_list.resources | default([]) | length > 0)
         else 'WARNING: No storageclass found!' }}
