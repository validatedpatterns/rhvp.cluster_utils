---
- name: Ensure oc is available
  ansible.builtin.include_role:
    name: oc_check

- name: Print cluster validation header
  ansible.builtin.shell: |
    printf "==> Checking cluster:"

- name: Check that we are logged into a cluster
  ansible.builtin.shell: |
    printf "    cluster-info: "
    if oc cluster-info >/dev/null 2>&1; then
      printf "OK"
    else
      printf "Error"
      exit 1
    fi

- name: Ensure we have storage classes defined
  ansible.builtin.shell: |
    set -o pipefail
    printf "    storageclass: "
    count="$(oc get storageclass -o name 2>/dev/null | wc -l | tr -d ' ')"
    if [ "${count}" -eq 0 ]; then
      printf "WARNING: No storageclass found"
    else
      printf "OK"
    fi
