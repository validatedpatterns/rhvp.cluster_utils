---
- name: Resolve defaults with ansible var/env var overrides
  ansible.builtin.import_tasks: resolve_overrides.yml

- name: Load values-global.yaml
  ansible.builtin.set_fact:
    values_global: "{{ lookup('file', pattern_dir + '/values-global.yaml') | from_yaml }}"

- name: Fail if main.clusterGroupName is missing
  ansible.builtin.shell: |
    printf "ERROR\n" > /dev/tty
    printf "    values-global.yaml does not define .main.clusterGroupName.\n" > /dev/tty
    printf "    Please set a value for main.clusterGroupName under the 'main' key.\n" > /dev/tty
    exit 1
  when: (values_global.main.clusterGroupName | default('') | string | trim) == ""

- name: Set fact for main clustergroup
  ansible.builtin.set_fact:
    main_clustergroup: "{{ values_global.main.clusterGroupName }}"
